<html>
	<head>
		<link rel='stylesheet' type='text/css' href='/brickbreaker.css'/>		
	</head>
	<body>

		<div id='game'>
			<div id='ball'></div>
			<div id='paddle'></div>
		</div>

	<script src="https://code.jquery.com/jquery-3.3.1.min.js"
					integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
				  crossorigin="anonymous"></script>

  <script src='BrickBreaker.js'></script>
  <script src='Brick.js'></script>
  <script src='InitView.js'></script>
  <script src='MovePaddleHandler.js'></script>
  <script src='QuadTreeNode.js'></script>

  <script>

  	$(function() {  		

  		const game = new BrickBreaker(20, 20, 300, 500, 5, 10);
  		InitView(game);

  		const mouseMoveHandlers = (function() {
  			const paddle = $('#paddle');
  			const container = $('#game');
  			const point = {'x': null, 'y': null};
  			return [function(evt) { MovePaddleHandler(point, paddle, container, evt); },
  							function() { point.x = null, point.y = null}]
  		})();

  		$(document).on('mousedown', function(evt) {
	  		$(document).on('mousemove', mouseMoveHandlers[0]);
  		});	

  		$(document).on('mouseup', function(evt) {
  			mouseMoveHandlers[1]();
	  		$(document).off('mousemove', mouseMoveHandlers[0]);
  		});	


  		const moveBall = (function() {

  			const ball = $('#ball');
  			const container = $('#game');
				const containerWidth = container.css('width').slice(0, -2);
        const containerRight = Number(containerWidth); // left is zero b/c of relative positioning
				const containerHeight = Number(container.css('height').slice(0, -2));

				let theta = Math.PI / 4;
        let vector = {
          'velocity': 1,
          'theta': 3.14 / 4,
          'x': Math.cos(3.14 / 4),
          'y': Math.sin(3.14 / 4)
        };


  			return function() {

  				const currentX = Number(ball.css('left').slice(0, -2));
  				const currentY = Number(ball.css('bottom').slice(0, -2));

          let impactedBrick = game.detectCollision(currentX, containerHeight - currentY);

          if (impactedBrick != null) {
             $(`div[brick=${impactedBrick.id}]`).remove();
          }

          // left wall collision
  				if (currentX + vector.x < 0) {            
            vector.x *= -1 + (Math.random() - 0.5) / 4; 
          }

          // right wall collision
          if (currentX + vector.x > containerRight) {
            vector.x *= -1 + (Math.random() - 0.5) / 4; 
          }

          // top wall collision
          if (currentY + vector.y > containerHeight) {
            vector.y *= -1 + (Math.random() - 0.5) / 4; 
          }

          // bottom wall collision
          if (currentY + vector.y < 0) {
            vector.y *= -1 + (Math.random() - 0.5) / 4; 
          }

  				ball.css('left', String(currentX + vector.x) + 'px');
  				ball.css('bottom', String(currentY + vector.y) + 'px');

  			}

  		})()

	  	window.setInterval(moveBall, 10);

  	});

  </script>

	</body>
</html>





